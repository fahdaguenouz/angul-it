<div class="page">
  <div class="card">

    <div class="header">
      <div>
        <h2>Captcha</h2>
        <p class="muted">Stage {{ currentIndex + 1 }} / {{ stages.length }}</p>

        <h3>{{ stage?.title }}</h3>
        <p class="muted" *ngIf="stage?.hint">{{ stage?.hint }}</p>
      </div>
      <span class="badge">{{ currentIndex + 1 }}/{{ stages.length }}</span>
    </div>

    <!-- IMAGE SELECT -->
    <div *ngIf="imageStage as s">
      <div class="grid">
        <button
          type="button"
          class="tile"
          *ngFor="let img of s.images"
          (click)="toggleImage(img.id)"
          [class.selected]="selected.has(img.id)"
          [attr.aria-pressed]="selected.has(img.id)"
        >
          <img [src]="img.url" [alt]="img.label" />
        </button>
      </div>
      <div class="helper">Select all that match the rule, then press Next.</div>
    </div>

    <!-- MATH -->
    <div *ngIf="mathStage as s" class="field">
      <div class="helper"><b>{{ s.question }}</b> =</div>
      <input class="input" type="text" [formControl]="mathCtrl" placeholder="Your answer..." />
      <div class="field-error" *ngIf="mathCtrl.touched && mathCtrl.invalid">
        Answer is required.
      </div>
    </div>

    <!-- TEXT -->
    <div *ngIf="textStage as s" class="field">
      <div class="helper"><b>{{ s.prompt }}</b></div>
      <input class="input" type="text" [formControl]="textCtrl" placeholder="Type exactly..." />
      <div class="field-error" *ngIf="textCtrl.touched && textCtrl.invalid">
        Text is required.
      </div>
    </div>

    <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>

    <div class="actions">
      <button class="btn btn-ghost" (click)="prev()" [disabled]="currentIndex === 0">Prev</button>
      <button class="btn btn-primary" (click)="next()">Next</button>
    </div>

  </div>
</div>
